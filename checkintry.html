
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Divine Guest House – Check-in</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,300&family=Playfair+Display:wght@500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --brand-50: #faf9f7;
      --brand-100: #f0efed;
      --brand-200: #e8e5e0;
      --brand-300: #a89f95;
      --brand-400: #7a756e;
      --brand-500: #1a1a1a;
      --success: #22a667;
      --error: #d44a3a;
      --radius-xl: 2rem;
      --radius-lg: 1rem;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      font-family: 'DM Sans', sans-serif;
      background-color: var(--brand-50);
      color: var(--brand-500);
      line-height: 1.5;
      overflow-x: hidden;
    }

    .app-container {
      max-width: 440px;
      margin: 0 auto;
      background: #fff;
      min-height: 100vh;
      box-shadow: 0 0 50px rgba(0,0,0,0.05);
      position: relative;
      display: flex;
      flex-direction: column;
    }

    /* Header & Admin Controls */
    header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--brand-100);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(10px);
      z-index: 100;
    }

    .brand h1 { font-family: 'Playfair Display', serif; font-size: 1.5rem; }
    .brand span { color: var(--brand-300); font-weight: 400; }
    .brand p { font-size: 10px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.1em; color: var(--brand-300); margin-top: 4px; }

    .admin-controls { text-align: right; cursor: pointer; }
    .dt-display { font-weight: 700; font-size: 0.85rem; display: flex; align-items: center; gap: 6px; }
    .dt-display .dot { width: 4px; height: 4px; background: var(--brand-200); border-radius: 50%; }
    .admin-controls small { font-size: 9px; font-weight: 800; color: var(--brand-300); text-transform: uppercase; display: flex; align-items: center; justify-content: flex-end; gap: 4px; margin-top: 2px; }

    .admin-edit-panel { display: none; padding: 10px; background: var(--brand-50); border-radius: 12px; margin-top: 8px; border: 1px solid var(--brand-200); }
    .admin-edit-panel input { padding: 4px 8px; border: 1px solid var(--brand-200); border-radius: 6px; font-size: 12px; margin-bottom: 4px; width: 100%; }
    .admin-edit-panel button { width: 100%; background: var(--brand-500); color: #fff; border: none; padding: 6px; border-radius: 6px; font-size: 11px; font-weight: 800; }

    /* Main Content */
    main { padding: 1.5rem; flex: 1; padding-bottom: 120px; }
    section { margin-bottom: 2.5rem; }
    h2 { font-size: 11px; font-weight: 900; text-transform: uppercase; letter-spacing: 0.2em; color: var(--brand-300); margin-bottom: 1rem; }

    /* Stay Types */
    .stay-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    .stay-card {
      padding: 12px; border-radius: 1.25rem; border: 2px solid var(--brand-50); background: var(--brand-50);
      text-align: center; cursor: pointer; transition: all 0.3s;
    }
    .stay-card.active { background: var(--brand-500); color: #fff; border-color: var(--brand-500); transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
    .stay-card b { display: block; font-size: 13px; font-weight: 800; }
    .stay-card span { font-size: 9px; font-weight: 600; opacity: 0.6; }

    /* Room Badge */
    .room-assignment-box {
      background: var(--brand-50); border-radius: var(--radius-xl); padding: 1.5rem; display: flex; align-items: center; gap: 1.5rem;
      border: 2px solid var(--brand-50);
    }
    .room-icon { width: 60px; height: 60px; background: #fff; border-radius: 1.25rem; display: flex; align-items: center; justify-content: center; border: 1px solid var(--brand-100); }
    .room-info small { font-size: 10px; font-weight: 800; color: var(--brand-300); text-transform: uppercase; }
    .room-info .number { font-size: 2.5rem; font-weight: 900; line-height: 1; margin: 4px 0; }
    .room-info .type { font-size: 11px; font-weight: 600; color: var(--brand-400); }
    .change-room-btn { margin-left: auto; background: #fff; border: 1px solid var(--brand-200); padding: 8px 12px; border-radius: 10px; font-size: 10px; font-weight: 800; cursor: pointer; }

    /* Inputs */
    .input-group { margin-bottom: 1rem; position: relative; }
    .input-group input {
      width: 100%; padding: 1.25rem 1.5rem; background: var(--brand-50); border: 2px solid transparent; border-radius: 1.25rem;
      font-size: 1.1rem; font-weight: 700; outline: none; transition: all 0.3s;
    }
    .input-group input:focus { background: #fff; border-color: var(--brand-500); }

    /* Document Upload */
    .upload-label {
      display: block; width: 100%; aspect-ratio: 16/9; border: 4px dashed var(--brand-100); border-radius: 2rem;
      overflow: hidden; position: relative; cursor: pointer; background: var(--brand-50); transition: all 0.3s;
    }
    .upload-label.has-file { border-color: var(--success); border-style: solid; }
    .upload-placeholder { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
    .upload-placeholder svg { width: 32px; height: 32px; color: var(--brand-300); margin-bottom: 10px; }
    .upload-placeholder span { font-size: 13px; font-weight: 800; color: var(--brand-500); }
    .upload-placeholder small { font-size: 10px; color: var(--brand-300); }
    .upload-preview { width: 100%; height: 100%; object-fit: cover; display: none; }

    /* Payment Panel */
    .payment-card { background: var(--brand-500); color: #fff; padding: 2rem; border-radius: 2rem; box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
    .pay-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 2rem; }
    .pay-header small { font-size: 9px; text-transform: uppercase; letter-spacing: 0.2em; opacity: 0.6; font-weight: 900; display: block; margin-bottom: 4px; }
    .pay-header .total { font-size: 3rem; font-weight: 900; line-height: 1; }
    .split-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    .split-input { background: rgba(255,255,255,0.1); border-radius: 1rem; padding: 1rem; }
    .split-input label { font-size: 9px; font-weight: 900; text-transform: uppercase; opacity: 0.5; margin-bottom: 8px; display: block; }
    .split-input .val { display: flex; align-items: center; gap: 4px; font-size: 1.25rem; font-weight: 900; }
    .split-input input { background: transparent; border: none; color: #fff; font-weight: 900; width: 100%; outline: none; }

    /* Footer Button */
    footer { position: fixed; bottom: 0; left: 0; right: 0; padding: 1.5rem; z-index: 100; pointer-events: none; }
    .submit-btn {
      width: 100%; max-width: 392px; margin: 0 auto; background: var(--brand-500); color: #fff; border: none;
      padding: 1.5rem; border-radius: 2rem; font-size: 1.25rem; font-weight: 900; cursor: pointer;
      box-shadow: 0 20px 50px rgba(0,0,0,0.3); pointer-events: auto; display: flex; align-items: center; justify-content: center; gap: 12px;
      transition: all 0.2s;
    }
    .submit-btn:active { transform: scale(0.96); }
    .submit-btn:disabled { opacity: 0.5; cursor: not-allowed; }

    /* Success Overlay */
    .success-overlay {
      position: fixed; inset: 0; background: #fff; z-index: 1000; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 2rem; text-align: center;
    }
    .success-icon { width: 80px; height: 80px; background: var(--success); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; margin-bottom: 2rem; box-shadow: 0 10px 30px rgba(34,166,103,0.3); }
    .success-title { font-family: 'Playfair Display', serif; font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem; }
    .success-room { background: var(--brand-50); padding: 2rem; border-radius: 2rem; width: 100%; margin: 2rem 0; }
    .success-room .num { font-size: 5rem; font-weight: 900; line-height: 1; }

    /* Room Picker List */
    #room-list { display: none; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 1rem; animation: slideIn 0.3s ease-out; }
    @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    .room-picker-item { padding: 12px; border: 2px solid var(--brand-100); border-radius: 1rem; cursor: pointer; text-align: left; }
    .room-picker-item.active { border-color: var(--brand-500); background: var(--brand-50); }
    .room-picker-item b { font-size: 14px; display: block; }
    .room-picker-item span { font-size: 10px; color: var(--brand-300); font-weight: 800; text-transform: uppercase; }

    /* Utils */
    .hidden { display: none; }
    .error-toast { position: fixed; top: 100px; left: 50%; transform: translateX(-50%); background: var(--error); color: #fff; padding: 12px 24px; border-radius: 12px; font-weight: 800; font-size: 12px; z-index: 2000; display: none; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
  </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.4",
    "react-dom/": "https://esm.sh/react-dom@^19.2.4/",
    "react/": "https://esm.sh/react@^19.2.4/"
  }
}
</script>
</head>
<body>

<div class="app-container">
  <div id="error-toast" class="error-toast"></div>

  <header>
    <div class="brand">
      <h1>Divine <span>Guest House</span></h1>
      <p>Self Check-in Portal</p>
    </div>
    <div class="admin-controls" id="admin-trigger">
      <div class="dt-display">
        <span id="display-date">--</span>
        <span class="dot"></span>
        <span id="display-time">--</span>
      </div>
      <small>
        <svg style="width:10px;height:10px" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path></svg>
        Admin Lock
      </small>
      <div id="admin-panel" class="admin-edit-panel">
        <input type="date" id="input-date">
        <input type="time" id="input-time">
        <button id="save-admin">Unlock & Save</button>
      </div>
    </div>
  </header>

  <main>
    <!-- Stay Selection -->
    <section>
      <h2>1. Stay Duration</h2>
      <div class="stay-grid">
        <div class="stay-card active" data-type="Daycation">
          <b>Day</b>
          <span>12 PM - 5 PM</span>
        </div>
        <div class="stay-card" data-type="Staycation">
          <b>Night</b>
          <span>6 PM - 11 AM</span>
        </div>
        <div class="stay-card" data-type="Full Stay">
          <b>Full</b>
          <span>Staycation</span>
        </div>
      </div>
    </section>

    <!-- Room Selection -->
    <section>
      <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
        <h2 style="margin-bottom:0">2. Assigned Room</h2>
        <button class="change-room-btn" id="toggle-room-picker">Change</button>
      </div>
      <div class="room-assignment-box">
        <div class="room-icon">
          <svg style="width:24px;height:24px" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
        </div>
        <div class="room-info">
          <small>Room Number</small>
          <div class="number" id="room-number">--</div>
          <div class="type" id="room-type">Auto Selecting...</div>
        </div>
      </div>
      <div id="room-list"></div>
    </section>

    <!-- Guest Details -->
    <section>
      <h2>3. Guest Identity</h2>
      <div class="input-group">
        <input type="text" id="guest-name" placeholder="Full Name">
      </div>
      <div class="input-group">
        <input type="tel" id="guest-phone" placeholder="Phone Number" maxlength="10">
      </div>
    </section>

    <!-- ID Verification -->
    <section>
      <h2>4. ID Verification</h2>
      <input type="file" id="id-input" accept="image/*" capture="environment" class="hidden">
      <label for="id-input" class="upload-label" id="id-label">
        <div class="upload-placeholder" id="upload-placeholder">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
          <span>Snap ID Photo</span>
          <small>Aadhaar, Passport or PAN</small>
        </div>
        <img src="" class="upload-preview" id="id-preview">
      </label>
    </section>

    <!-- Payment Panel -->
    <section style="padding-bottom: 2rem;">
      <h2>5. Payment Details</h2>
      <div class="payment-card">
        <div class="pay-header">
          <div>
            <small>Total Received</small>
            <div class="total">₹<span id="total-val">0</span></div>
          </div>
          <div style="text-align:right">
            <small>Method</small>
            <div id="pay-method-badge" style="font-size: 10px; font-weight: 800; background: rgba(255,255,255,0.2); padding: 4px 8px; border-radius: 20px;">Pending</div>
          </div>
        </div>
        <div class="split-grid">
          <div class="split-input">
            <label>Online</label>
            <div class="val">
              <span>₹</span>
              <input type="number" id="pay-online" placeholder="0">
            </div>
          </div>
          <div class="split-input">
            <label>Cash</label>
            <div class="val">
              <span>₹</span>
              <input type="number" id="pay-cash" placeholder="0">
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <button class="submit-btn" id="submit-btn">
      Confirm Check-in
      <svg style="width:20px;height:20px" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M13 7l5 5m0 0l-5 5m5-5H6"></path></svg>
    </button>
  </footer>
</div>

<!-- Success Screen -->
<div class="success-overlay" id="success-overlay">
  <div class="success-icon">
    <svg style="width:40px;height:40px" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
  </div>
  <h1 class="success-title">Check-in Success</h1>
  <p style="color:var(--brand-300); font-weight: 500;">Your room is ready for check-in</p>
  
  <div class="success-room">
    <small style="font-size:10px; font-weight: 900; text-transform: uppercase; color: var(--brand-300); letter-spacing: 0.2em;">Assigned Room</small>
    <div class="num" id="success-room-num">--</div>
  </div>

  <div style="text-align:left; width: 100%; max-width: 300px; margin: 0 auto 2rem; border-top: 1px solid var(--brand-100); padding-top: 1rem;">
    <div style="display:flex; justify-content:space-between; margin-bottom: 8px;">
      <span style="font-size:11px; color:var(--brand-300); font-weight: 700;">Guest</span>
      <b id="success-name" style="font-size:13px">--</b>
    </div>
    <div style="display:flex; justify-content:space-between; margin-bottom: 8px;">
      <span style="font-size:11px; color:var(--brand-300); font-weight: 700;">Reference</span>
      <b id="success-token" style="font-size:13px; font-family: monospace;">--</b>
    </div>
  </div>

  <button class="submit-btn" style="box-shadow: none;" onclick="location.reload()">Done</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  // Config
  const SUPABASE_URL = 'https://fzwnglhxtmtltpysdzma.supabase.co';
  const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ6d25nbGh4dG10bHRweXNkem1hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg1ODE0MzAsImV4cCI6MjA4NDE1NzQzMH0.PuES2nphqkKU-FqzBge6LlptVibSfeTQcUExEdfTleg';
  const db = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  const ROOM_MAP = {
    'Cozy Mini': ['102','201','202','301','302'],
    'Compact Twin': ['203','303'],
    'Convenient Queen': ['101']
  };

  // State
  let appState = {
    date: new Date().toISOString().split('T')[0],
    time: new Date().toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit' }),
    stayType: 'Daycation',
    roomType: null,
    roomNumber: null,
    docFile: null,
    availability: {}
  };

  // UI Elements
  const el = (id) => document.getElementById(id);
  const elements = {
    displayDate: el('display-date'),
    displayTime: el('display-time'),
    adminTrigger: el('admin-trigger'),
    adminPanel: el('admin-panel'),
    inputDate: el('input-date'),
    inputTime: el('input-time'),
    saveAdmin: el('save-admin'),
    roomNumber: el('room-number'),
    roomType: el('room-type'),
    totalVal: el('total-val'),
    payMethodBadge: el('pay-method-badge'),
    submitBtn: el('submit-btn'),
    idInput: el('id-input'),
    idPreview: el('id-preview'),
    idLabel: el('id-label'),
    uploadPlaceholder: el('upload-placeholder'),
    roomList: el('room-list'),
    toggleRoomPicker: el('toggle-room-picker')
  };

  // Init
  function init() {
    updateDTDisplay();
    elements.inputDate.value = appState.date;
    elements.inputTime.value = appState.time;
    fetchAvailability();

    // Event Listeners
    elements.adminTrigger.onclick = (e) => {
      if(e.target.closest('#admin-panel')) return;
      elements.adminPanel.style.display = elements.adminPanel.style.display === 'block' ? 'none' : 'block';
    };

    elements.saveAdmin.onclick = () => {
      appState.date = elements.inputDate.value;
      appState.time = elements.inputTime.value;
      updateDTDisplay();
      elements.adminPanel.style.display = 'none';
      fetchAvailability();
    };

    document.querySelectorAll('.stay-card').forEach(card => {
      card.onclick = () => {
        document.querySelectorAll('.stay-card').forEach(c => c.classList.remove('active'));
        card.classList.add('active');
        appState.stayType = card.dataset.type;
        fetchAvailability();
      };
    });

    elements.idInput.onchange = (e) => {
      const file = e.target.files[0];
      if(!file) return;
      appState.docFile = file;
      const reader = new FileReader();
      reader.onload = (ev) => {
        elements.idPreview.src = ev.target.result;
        elements.idPreview.style.display = 'block';
        elements.uploadPlaceholder.style.display = 'none';
        elements.idLabel.classList.add('has-file');
      };
      reader.readAsDataURL(file);
    };

    const updatePayments = () => {
      const online = parseFloat(el('pay-online').value) || 0;
      const cash = parseFloat(el('pay-cash').value) || 0;
      const total = online + cash;
      elements.totalVal.textContent = total;
      elements.payMethodBadge.textContent = (online && cash) ? 'Split Pay' : online ? 'Online' : cash ? 'Cash' : 'Pending';
      elements.payMethodBadge.style.background = total > 0 ? 'var(--success)' : 'rgba(255,255,255,0.2)';
    };

    el('pay-online').oninput = updatePayments;
    el('pay-cash').oninput = updatePayments;

    elements.toggleRoomPicker.onclick = () => {
      elements.roomList.style.display = elements.roomList.style.display === 'grid' ? 'none' : 'grid';
      renderRoomPicker();
    };

    elements.submitBtn.onclick = handleCheckin;
  }

  function updateDTDisplay() {
    elements.displayDate.textContent = new Date(appState.date).toLocaleDateString('en-IN', { day: '2-digit', month: 'short' });
    elements.displayTime.textContent = appState.time;
  }

  async function fetchAvailability() {
    try {
      const { data, error } = await db.from('bookings').select('room_number').eq('check_in_date', appState.date).eq('stay_type', appState.stayType);
      if(error) throw error;

      const occupied = (data || []).map(b => b.room_number);
      const avail = {};
      Object.keys(ROOM_MAP).forEach(type => {
        avail[type] = ROOM_MAP[type].filter(r => !occupied.includes(r));
      });
      appState.availability = avail;

      // Auto-assign logic
      let found = false;
      for (const type of Object.keys(ROOM_MAP)) {
        if(avail[type].length > 0) {
          appState.roomType = type;
          appState.roomNumber = avail[type][0];
          found = true;
          break;
        }
      }

      if(!found) {
        elements.roomNumber.textContent = "FULL";
        elements.roomType.textContent = "No Rooms Left Today";
        appState.roomNumber = null;
      } else {
        elements.roomNumber.textContent = appState.roomNumber;
        elements.roomType.textContent = appState.roomType;
      }
      renderRoomPicker();
    } catch(err) {
      console.error(err);
      toast("Error checking availability");
    }
  }

  function renderRoomPicker() {
    elements.roomList.innerHTML = '';
    Object.keys(ROOM_MAP).forEach(type => {
      const count = appState.availability[type]?.length || 0;
      const first = appState.availability[type]?.[0] || '--';
      const item = document.createElement('div');
      item.className = `room-picker-item ${appState.roomType === type ? 'active' : ''} ${count === 0 ? 'opacity-30' : ''}`;
      item.innerHTML = `
        <span>${type}</span>
        <b>Room ${first}</b>
        <small style="font-size:8px; font-weight:800; color:${count > 0 ? 'var(--success)' : 'var(--error)'}">${count} Available</small>
      `;
      if(count > 0) {
        item.onclick = () => {
          appState.roomType = type;
          appState.roomNumber = first;
          elements.roomNumber.textContent = first;
          elements.roomType.textContent = type;
          elements.roomList.style.display = 'none';
          renderRoomPicker();
        };
      }
      elements.roomList.appendChild(item);
    });
  }

  function toast(msg) {
    const t = el('error-toast');
    t.textContent = msg;
    t.style.display = 'block';
    setTimeout(() => t.style.display = 'none', 3000);
  }

  async function handleCheckin() {
    const name = el('guest-name').value.trim();
    const phone = el('guest-phone').value.trim();
    const online = parseFloat(el('pay-online').value) || 0;
    const cash = parseFloat(el('pay-cash').value) || 0;
    const total = online + cash;

    if(!name) return toast("Name is required");
    if(phone.length < 10) return toast("Valid phone is required");
    if(!appState.roomNumber) return toast("No room selected");
    if(total <= 0) return toast("Payment amount required");
    if(!appState.docFile) return toast("ID Document required");

    elements.submitBtn.disabled = true;
    elements.submitBtn.textContent = "Processing...";

    try {
      // 1. Upload Doc
      const ext = appState.docFile.name.split('.').pop();
      const path = `guest-photos/${Date.now()}_${Math.random().toString(36).slice(2, 8)}.${ext}`;
      const { error: uploadError } = await db.storage.from('guest-photos').upload(path, appState.docFile);
      if(uploadError) throw uploadError;
      const { data: urlData } = db.storage.from('guest-photos').getPublicUrl(path);

      // 2. Insert Booking
      const booking = {
        full_name: name,
        phone_number: phone,
        check_in_date: appState.date,
        arrival_time: appState.time,
        stay_type: appState.stayType,
        room_type: appState.roomType,
        room_number: appState.roomNumber,
        total_amount: total,
        payment_online: online,
        payment_cash: cash,
        status: 'confirmed',
        payment_status: 'paid',
        guest_photo_url: urlData.publicUrl,
        qr_token: 'DGH-' + Math.random().toString(36).substr(2, 6).toUpperCase()
      };

      const { data, error } = await db.from('bookings').insert([booking]).select();
      if(error) throw error;

      // 3. Success
      const result = data[0];
      el('success-room-num').textContent = result.room_number;
      el('success-name').textContent = result.full_name;
      el('success-token').textContent = result.qr_token;
      el('success-overlay').style.display = 'flex';

    } catch(err) {
      console.error(err);
      toast("Check-in failed. Try again.");
      elements.submitBtn.disabled = false;
      elements.submitBtn.textContent = "Confirm Check-in";
    }
  }

  init();
</script>
</body>
</html>
